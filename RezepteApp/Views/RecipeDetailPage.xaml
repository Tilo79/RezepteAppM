<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:RezepteApp.ViewModels"
             x:Class="RezepteApp.Views.RecipeDetailPage"
             x:DataType="viewmodels:RecipeDetailViewModel"
             Title="{Binding Recipe.Name}"
             BackgroundColor="#FFFBFC">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">
            <!-- Recipe Image Placeholder -->
            <Border BackgroundColor="{StaticResource CardPink}" HeightRequest="200" StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="15"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="{StaticResource Gray400}" Offset="0,4" Radius="15" Opacity="0.15"/>
                </Border.Shadow>
                <Label Text="🍽️"
                       FontSize="80"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
            </Border>

            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="10">
                <Button Grid.Column="0"
                        Text="{Binding IsFavorite, Converter={StaticResource FavoriteTextConverter}}"
                        Command="{Binding ToggleFavoriteCommand}"
                        FontSize="12"/>
                <Button Grid.Column="1"
                        Text="⭐ Bewerten"
                        Command="{Binding RateRecipeCommand}"
                        FontSize="12"/>
                <Button Grid.Column="2"
                        Text="🛒 Einkauf"
                        Command="{Binding AddToShoppingListCommand}"
                        FontSize="12"/>
                <Button Grid.Column="3"
                        Text="📤 Teilen"
                        Command="{Binding ShareRecipeCommand}"
                        FontSize="12"/>
            </Grid>

            <!-- Recipe Info -->
            <Border StrokeThickness="0" BackgroundColor="#FFF5E6" Padding="15">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12"/>
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="#FFE66D" Offset="0,2" Radius="8" Opacity="0.2"/>
                </Border.Shadow>
                <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,*,*">
                    <StackLayout Grid.Row="0" Grid.Column="0">
                        <Label Text="Kategorie" FontSize="12" TextColor="Gray"/>
                        <Label Text="{Binding Recipe.Category}" FontSize="14" FontAttributes="Bold"/>
                    </StackLayout>
                    <StackLayout Grid.Row="0" Grid.Column="1">
                        <Label Text="Schwierigkeit" FontSize="12" TextColor="Gray"/>
                        <Label Text="{Binding Recipe.Difficulty}" FontSize="14" FontAttributes="Bold"/>
                    </StackLayout>
                    <StackLayout Grid.Row="0" Grid.Column="2">
                        <Label Text="Portionen" FontSize="12" TextColor="Gray"/>
                        <Label Text="{Binding Recipe.Servings}" FontSize="14" FontAttributes="Bold"/>
                    </StackLayout>

                    <StackLayout Grid.Row="1" Grid.Column="0" Margin="0,10,0,0">
                        <Label Text="Vorbereitung" FontSize="12" TextColor="Gray"/>
                        <Label FontSize="14" FontAttributes="Bold">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding Recipe.PrepTimeMinutes}"/>
                                    <Span Text=" Min"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </StackLayout>
                    <StackLayout Grid.Row="1" Grid.Column="1" Margin="0,10,0,0">
                        <Label Text="Kochzeit" FontSize="12" TextColor="Gray"/>
                        <Label FontSize="14" FontAttributes="Bold">
                            <Label.FormattedText>
                                <FormattedString>
                                    <Span Text="{Binding Recipe.CookingTimeMinutes}"/>
                                    <Span Text=" Min"/>
                                </FormattedString>
                            </Label.FormattedText>
                        </Label>
                    </StackLayout>
                    <StackLayout Grid.Row="1" Grid.Column="2" Margin="0,10,0,0">
                        <Label Text="Bewertung" FontSize="12" TextColor="Gray"/>
                        <Label Text="{Binding Recipe.RatingDisplay}" FontSize="14" FontAttributes="Bold"/>
                    </StackLayout>
                </Grid>
            </Border>

            <!-- Description -->
            <StackLayout>
                <Label Text="Beschreibung"
                       FontSize="18"
                       FontAttributes="Bold"
                       Margin="0,10,0,5"/>
                <Label Text="{Binding Recipe.Description}"
                       FontSize="14"
                       TextColor="Gray"/>
            </StackLayout>

            <!-- Ingredients -->
            <StackLayout>
                <Label Text="Zutaten"
                       FontSize="18"
                       FontAttributes="Bold"
                       Margin="0,10,0,5"/>
                <Border StrokeThickness="0" BackgroundColor="#E8F8F5" Padding="15">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <CollectionView ItemsSource="{Binding Recipe.IngredientList}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="{x:Null}">
                                <Label Margin="0,5"
                                       Text="{Binding .}"
                                       LineBreakMode="WordWrap"/>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Border>
            </StackLayout>

            <!-- Instructions -->
            <StackLayout>
                <Label Text="Zubereitung"
                       FontSize="18"
                       FontAttributes="Bold"
                       Margin="0,10,0,5"/>
                <Border StrokeThickness="0" BackgroundColor="#FFF0F5" Padding="15">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Label Text="{Binding Recipe.Instructions}"
                           FontSize="14"/>
                </Border>
            </StackLayout>

            <!-- Nutritional Info -->
            <StackLayout>
                <Label Text="Nährwertangaben (pro Portion)"
                       FontSize="18"
                       FontAttributes="Bold"
                       Margin="0,10,0,5"/>
                <Border StrokeThickness="0" BackgroundColor="#E3F2FD" Padding="15">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="10">
                        <StackLayout Grid.Column="0">
                            <Label Text="Kalorien" FontSize="12" TextColor="Gray"/>
                            <Label FontSize="14" FontAttributes="Bold">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding Recipe.Calories}"/>
                                        <Span Text=" kcal"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </StackLayout>
                        <StackLayout Grid.Column="1">
                            <Label Text="Protein" FontSize="12" TextColor="Gray"/>
                            <Label FontSize="14" FontAttributes="Bold">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding Recipe.Protein}"/>
                                        <Span Text="g"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </StackLayout>
                        <StackLayout Grid.Column="2">
                            <Label Text="Kohlenhydrate" FontSize="12" TextColor="Gray"/>
                            <Label FontSize="14" FontAttributes="Bold">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding Recipe.Carbohydrates}"/>
                                        <Span Text="g"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </StackLayout>
                        <StackLayout Grid.Column="3">
                            <Label Text="Fett" FontSize="12" TextColor="Gray"/>
                            <Label FontSize="14" FontAttributes="Bold">
                                <Label.FormattedText>
                                    <FormattedString>
                                        <Span Text="{Binding Recipe.Fat}"/>
                                        <Span Text="g"/>
                                    </FormattedString>
                                </Label.FormattedText>
                            </Label>
                        </StackLayout>
                    </Grid>
                </Border>
            </StackLayout>

            <!-- Edit and Delete Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="0,20,0,0">
                <Button Grid.Column="0"
                        Text="Bearbeiten"
                        Command="{Binding EditRecipeCommand}"
                        BackgroundColor="#4ECDC4"/>
                <Button Grid.Column="1"
                        Text="Löschen"
                        Command="{Binding DeleteRecipeCommand}"
                        BackgroundColor="#FF6B6B"/>
            </Grid>
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
